-- Lists nodes with metadata invenrory, when none is expected.
-- Lists node name, count of such nodes w/ inventory, and example coords.
--
-- Ex:
-- $ sqlite3 -header -column ./output.sqlite \
--      < reports/nodes-with-unexpected-inventory.sql


create temp table temp.expected_nodes (
  name text not null
);

insert into expected_nodes values
  ('3d_armor_stand:armor_stand'),
  ('3d_armor_stand:locked_armor_stand'),
  ('anvil:anvil'),
  ('bbq:kettle_grill'),
  ('bbq:propane_grill'),
  ('bbq:propane_grill_pro'),
  ('bbq:smoker'),
  ('bbq:woodpile'),
  ('bbq:woodpile_junglewood'),
  ('beacon:black'),
  ('beacon:blue'),
  ('beacon:cyan'),
  ('beacon:green'),
  ('beacon:magenta'),
  ('beacon:red'),
  ('beacon:violet'),
  ('beacon:white'),
  ('beacon:yellow'),
  ('biofuel:refinery_active'),
  ('bones:bones'),
  ('currency:safe'),
  ('currency:shop'),
  ('currency:shop_empty'),
  ('default:bookshelf'),
  ('default:chest'),
  ('default:chest_locked'),
  ('default:chest_open'),
  ('default:furnace'),
  ('default:furnace_active'),
  ('digilines:chest'),
  ('digtron:auto_controller'),
  ('digtron:builder'),
  ('digtron:combined_storage'),
  ('digtron:fuelstore'),
  ('digtron:inventory'),
  ('draconis:draconic_forge_fire'),
  ('draconis:draconic_forge_ice'),
  ('draconis:frozen_stone'),
  ('draconis:lectern'),
  ('drawers:aspen_wood1'),
  ('drawers:aspen_wood4'),
  ('drawers:junglewood1'),
  ('drawers:junglewood4'),
  ('drawers:pine_wood1'),
  ('drawers:pine_wood4'),
  ('drawers:wood1'),
  ('drawers:wood2'),
  ('drawers:wood4'),
  ('easyvend:depositor'),
  ('easyvend:vendor'),
  ('ehlphabet:machine'),
  ('fancy_vend:player_vendor'),
  ('gravelsieve:auto_sieve0'),
  ('gravelsieve:auto_sieve1'),
  ('gravelsieve:auto_sieve2'),
  ('gravelsieve:auto_sieve3'),
  ('gravelsieve:sieve0'),
  ('gravelsieve:sieve1'),
  ('gravelsieve:sieve2'),
  ('gravelsieve:sieve3'),
  ('home_workshop_misc:tool_cabinet'),
  ('homedecor:cardboard_box_big'),
  ('homedecor:desk'),
  ('homedecor:desk_locked'),
  ('homedecor:filing_cabinet'),
  ('homedecor:filing_cabinet_locked'),
  ('homedecor:inbox'),
  ('homedecor:kitchen_cabinet_colorable'),
  ('homedecor:kitchen_cabinet_colorable_half'),
  ('homedecor:kitchen_cabinet_colorable_locked'),
  ('homedecor:kitchen_cabinet_colorable_marble_locked'),
  ('homedecor:kitchen_cabinet_colorable_steel'),
  ('homedecor:kitchen_cabinet_colorable_steel_locked'),
  ('homedecor:kitchen_cabinet_colorable_with_sink'),
  ('homedecor:kitchen_cabinet_colorable_with_sink_locked'),
  ('homedecor:medicine_cabinet'),
  ('homedecor:microwave_oven'),
  ('homedecor:microwave_oven_locked'),
  ('homedecor:nightstand_mahogany_one_drawer_locked'),
  ('homedecor:nightstand_oak_one_drawer_locked'),
  ('homedecor:nightstand_oak_two_drawers_locked'),
  ('homedecor:oven'),
  ('homedecor:oven_locked'),
  ('homedecor:oven_steel'),
  ('homedecor:oven_steel_locked'),
  ('homedecor:refrigerator_steel'),
  ('homedecor:refrigerator_steel_locked'),
  ('homedecor:refrigerator_white'),
  ('homedecor:refrigerator_white_locked'),
  ('homedecor:wardrobe'),
  ('inbox:empty'),
  ('jumpdrive:engine'),
  ('letters:letter_cutter_digit'),
  ('letters:letter_cutter_lower'),
  ('letters:letter_cutter_upper'),
  ('loot:loot_node'),
  ('missions:mission'),
  ('mobs:beehive'),
  ('more_chests:cobble'),
  ('more_chests:dropbox'),
  ('more_chests:secret'),
  ('more_chests:shared'),
  ('more_chests:toolbox_steel'),
  ('more_chests:toolbox_wood'),
  ('moreblocks:circular_saw'),
  ('moremesecons_mesechest:mesechest'),
  ('moremesecons_mesechest:mesechest_locked'),
  ('paleotest:dna_cultivator'),
  ('paleotest:feeder_carnivore'),
  ('paleotest:feeder_herbivore'),
  ('paleotest:feeder_piscivore'),
  ('paleotest:fossil_analyzer'),
  ('pipeworks:autocrafter'),
  ('pipeworks:deployer_off'),
  ('pipeworks:deployer_on'),
  ('pipeworks:filter'),
  ('pipeworks:mese_filter'),
  ('pipeworks:mese_tube_000000'),
  ('pipeworks:mese_tube_000010'),
  ('pipeworks:mese_tube_000011'),
  ('pipeworks:mese_tube_000100'),
  ('pipeworks:mese_tube_000110'),
  ('pipeworks:mese_tube_000111'),
  ('pipeworks:mese_tube_001001'),
  ('pipeworks:mese_tube_001010'),
  ('pipeworks:mese_tube_001011'),
  ('pipeworks:mese_tube_001110'),
  ('pipeworks:mese_tube_001111'),
  ('pipeworks:mese_tube_010010'),
  ('pipeworks:mese_tube_010011'),
  ('pipeworks:mese_tube_010100'),
  ('pipeworks:mese_tube_010101'),
  ('pipeworks:mese_tube_010110'),
  ('pipeworks:mese_tube_010111'),
  ('pipeworks:mese_tube_011000'),
  ('pipeworks:mese_tube_011001'),
  ('pipeworks:mese_tube_011010'),
  ('pipeworks:mese_tube_011011'),
  ('pipeworks:mese_tube_011100'),
  ('pipeworks:mese_tube_100010'),
  ('pipeworks:mese_tube_100011'),
  ('pipeworks:mese_tube_100100'),
  ('pipeworks:mese_tube_100101'),
  ('pipeworks:mese_tube_100110'),
  ('pipeworks:mese_tube_100111'),
  ('pipeworks:mese_tube_101001'),
  ('pipeworks:mese_tube_101010'),
  ('pipeworks:mese_tube_101100'),
  ('pipeworks:mese_tube_101101'),
  ('pipeworks:mese_tube_101110'),
  ('pipeworks:mese_tube_101111'),
  ('pipeworks:mese_tube_110001'),
  ('pipeworks:mese_tube_110010'),
  ('pipeworks:mese_tube_110011'),
  ('pipeworks:mese_tube_110100'),
  ('pipeworks:mese_tube_110110'),
  ('pipeworks:mese_tube_110111'),
  ('pipeworks:mese_tube_111000'),
  ('pipeworks:mese_tube_111010'),
  ('pipeworks:mese_tube_111011'),
  ('pipeworks:mese_tube_111100'),
  ('pipeworks:mese_tube_111101'),
  ('pipeworks:mese_tube_111110'),
  ('pipeworks:mese_tube_111111'),
  ('pipeworks:nodebreaker_off'),
  ('pipeworks:nodebreaker_on'),
  ('protector:chest'),
  ('smartshop:shop'),
  ('technic:coal_alloy_furnace'),
  ('technic:constructor_mk3_on'),
  ('technic:copper_chest'),
  ('technic:copper_locked_chest'),
  ('technic:copper_protected_chest'),
  ('technic:gold_chest'),
  ('technic:gold_chest_black'),
  ('technic:gold_chest_blue'),
  ('technic:gold_chest_dark_green'),
  ('technic:gold_chest_red'),
  ('technic:gold_locked_chest'),
  ('technic:gold_locked_chest_black'),
  ('technic:gold_locked_chest_blue'),
  ('technic:gold_locked_chest_brown'),
  ('technic:gold_locked_chest_cyan'),
  ('technic:gold_locked_chest_dark_green'),
  ('technic:gold_locked_chest_dark_grey'),
  ('technic:gold_locked_chest_green'),
  ('technic:gold_locked_chest_grey'),
  ('technic:gold_locked_chest_orange'),
  ('technic:gold_locked_chest_red'),
  ('technic:gold_locked_chest_white'),
  ('technic:gold_locked_chest_yellow'),
  ('technic:gold_protected_chest'),
  ('technic:gold_protected_chest_black'),
  ('technic:gold_protected_chest_blue'),
  ('technic:gold_protected_chest_brown'),
  ('technic:gold_protected_chest_grey'),
  ('technic:gold_protected_chest_pink'),
  ('technic:gold_protected_chest_yellow'),
  ('technic:hv_battery_box0'),
  ('technic:hv_battery_box1'),
  ('technic:hv_battery_box2'),
  ('technic:hv_battery_box3'),
  ('technic:hv_battery_box4'),
  ('technic:hv_battery_box5'),
  ('technic:hv_battery_box6'),
  ('technic:hv_battery_box7'),
  ('technic:hv_battery_box8'),
  ('technic:hv_compressor'),
  ('technic:hv_electric_furnace'),
  ('technic:hv_generator'),
  ('technic:hv_grinder'),
  ('technic:hv_nuclear_reactor_core'),
  ('technic:hv_nuclear_reactor_core_active'),
  ('technic:injector'),
  ('technic:iron_chest'),
  ('technic:iron_locked_chest'),
  ('technic:iron_protected_chest'),
  ('technic:lv_alloy_furnace'),
  ('technic:lv_battery_box0'),
  ('technic:lv_battery_box1'),
  ('technic:lv_battery_box2'),
  ('technic:lv_battery_box3'),
  ('technic:lv_battery_box4'),
  ('technic:lv_battery_box5'),
  ('technic:lv_battery_box6'),
  ('technic:lv_battery_box7'),
  ('technic:lv_battery_box8'),
  ('technic:lv_compressor'),
  ('technic:lv_electric_furnace'),
  ('technic:lv_extractor'),
  ('technic:lv_grinder'),
  ('technic:mithril_chest'),
  ('technic:mithril_locked_chest'),
  ('technic:mithril_protected_chest'),
  ('technic:mv_alloy_furnace'),
  ('technic:mv_battery_box0'),
  ('technic:mv_battery_box1'),
  ('technic:mv_battery_box2'),
  ('technic:mv_battery_box3'),
  ('technic:mv_battery_box4'),
  ('technic:mv_battery_box5'),
  ('technic:mv_battery_box6'),
  ('technic:mv_battery_box7'),
  ('technic:mv_battery_box8'),
  ('technic:mv_centrifuge'),
  ('technic:mv_compressor'),
  ('technic:mv_electric_furnace'),
  ('technic:mv_extractor'),
  ('technic:mv_freezer'),
  ('technic:mv_grinder'),
  ('technic:quarry'),
  ('technic:silver_chest'),
  ('technic:silver_locked_chest'),
  ('technic:tool_workshop'),
  ('vacuum:airpump'),
  ('vessels:shelf'),
  ('wine:wine_barrel'),
  ('xdecor:workbench')
;

with nodes_having_inventory as (
  select distinct pos_id from inventory
)

select n.name, count(1) as count, l.node_x, l.node_y, l.node_z
from node n, nodes l, nodes_having_inventory ni
where (n.node_id = l.node_id)
  and (ni.pos_id = l.pos_id)
  and (n.name not in (select name from temp.expected_nodes))
group by n.name
order by 1;
